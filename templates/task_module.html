<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Management</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <style>
        .energy-section {
            background-color: #f0f8ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .task-card {
            transition: transform 0.3s;
            margin-bottom: 15px;
        }
        .task-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .energy-meter {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            margin-top: 10px;
            overflow: hidden;
        }
        .energy-level {
            height: 100%;
            background-color: #4caf50;
            border-radius: 10px;
        }
        .task-badge {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        .task-progress {
            height: 8px;
            margin-top: 10px;
        }
        .task-tabs {
            margin-bottom: 20px;
        }
        .completed-task {
            opacity: 0.7;
        }
        .task-details {
            padding: 15px;
            border-left: 4px solid #007bff;
        }
        .priority-high {
            border-left-color: #dc3545;
        }
        .priority-medium {
            border-left-color: #ffc107;
        }
        .priority-low {
            border-left-color: #28a745;
        }
        .nav-link.active {
            font-weight: bold;
        }
        .motivational-quote {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-style: italic;
        }
        #energyLevelSlider {
            width: 100%;
        }
        .sidebar {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Navigation Bar -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
                <a class="navbar-brand" href="{{ url_for('dashboard') }}">AI Lifestyle Assistant</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('dashboard') }}">Dashboard</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('food_module') }}">Food Recommendations</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('outfit_module') }}">Outfit Suggestions</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="{{ url_for('task_module') }}">Task Management</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('chat') }}">AI Chat</a>
                        </li>
                    </ul>
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('logout') }}">Logout</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        
        <div class="container mt-4">
            <h1 class="mb-4">Task Management</h1>
            
            <!-- Motivational Quote -->
            <div class="motivational-quote">
                <p class="mb-0">"{{ motivational_quote }}"</p>
            </div>
            
            <div class="row">
                <!-- Main Content -->
                <div class="col-md-8">
                    <!-- Energy Level Input -->
                    <div class="energy-section">
                        <h3>Your Energy Level</h3>
                        <p>Set your current energy level to get personalized task recommendations.</p>
                        <div class="d-flex align-items-center mb-3">
                            <span class="me-2"><i class="fas fa-battery-empty"></i></span>
                            <input type="range" class="form-range" id="energyLevelSlider" min="1" max="10" value="{{ current_energy_level }}" step="1">
                            <span class="ms-2"><i class="fas fa-battery-full"></i></span>
                        </div>
                        <div class="energy-meter">
                            <div class="energy-level" style="width: {{ current_energy_level * 10 }}%"></div>
                        </div>
                        <div class="text-center mt-2">
                            <span id="energyLevelValue">{{ current_energy_level }}</span>/10
                        </div>
                        <button id="updateEnergyBtn" class="btn btn-primary mt-3">Update Energy Level</button>
                    </div>
                    
                    <!-- Task Tabs -->
                    <ul class="nav nav-tabs task-tabs" id="taskTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="recommended-tab" data-bs-toggle="tab" data-bs-target="#recommended" type="button" role="tab" aria-controls="recommended" aria-selected="true">Recommended</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="all-tab" data-bs-toggle="tab" data-bs-target="#all" type="button" role="tab" aria-controls="all" aria-selected="false">All Tasks</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="completed-tab" data-bs-toggle="tab" data-bs-target="#completed" type="button" role="tab" aria-controls="completed" aria-selected="false">Completed</button>
                        </li>
                    </ul>
                    
                    <!-- Tab Content -->
                    <div class="tab-content" id="taskTabsContent">
                        <!-- Recommended Tasks Tab -->
                        <div class="tab-pane fade show active" id="recommended" role="tabpanel" aria-labelledby="recommended-tab">
                            <div class="alert alert-info">
                                <p>Based on your current energy level ({{ current_energy_level }}/10), here are the recommended tasks:</p>
                            </div>
                            
                            <div id="recommendedTasksList">
                                {% for task in recommended_tasks %}
                                <div class="card task-card">
                                    <div class="card-body">
                                        <span class="task-badge badge {% if task.priority == 'high' %}bg-danger{% elif task.priority == 'medium' %}bg-warning{% else %}bg-success{% endif %}">
                                            {{ task.priority }}
                                        </span>
                                        <h5 class="card-title">{{ task.title }}</h5>
                                        <p class="card-text">{{ task.description }}</p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">Energy needed: {{ task.energy_required }}/10</small>
                                            <small class="text-muted">Due: {{ task.due_date }}</small>
                                        </div>
                                        <div class="progress task-progress">
                                            <div class="progress-bar" role="progressbar" style="width: {{ task.progress }}%" aria-valuenow="{{ task.progress }}" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <div class="mt-3">
                                            <button class="btn btn-sm btn-primary task-action" data-action="start" data-id="{{ task.id }}">Start</button>
                                            <button class="btn btn-sm btn-success task-action" data-action="complete" data-id="{{ task.id }}">Complete</button>
                                            <button class="btn btn-sm btn-info task-action" data-action="edit" data-id="{{ task.id }}">Edit</button>
                                            <button class="btn btn-sm btn-danger task-action" data-action="delete" data-id="{{ task.id }}">Delete</button>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <!-- All Tasks Tab -->
                        <div class="tab-pane fade" id="all" role="tabpanel" aria-labelledby="all-tab">
                            <div id="allTasksList">
                                {% for task in all_tasks %}
                                <div class="card task-card">
                                    <div class="card-body">
                                        <span class="task-badge badge {% if task.priority == 'high' %}bg-danger{% elif task.priority == 'medium' %}bg-warning{% else %}bg-success{% endif %}">
                                            {{ task.priority }}
                                        </span>
                                        <h5 class="card-title">{{ task.title }}</h5>
                                        <p class="card-text">{{ task.description }}</p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">Energy needed: {{ task.energy_required }}/10</small>
                                            <small class="text-muted">Due: {{ task.due_date }}</small>
                                        </div>
                                        <div class="progress task-progress">
                                            <div class="progress-bar" role="progressbar" style="width: {{ task.progress }}%" aria-valuenow="{{ task.progress }}" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <div class="mt-3">
                                            <button class="btn btn-sm btn-primary task-action" data-action="start" data-id="{{ task.id }}">Start</button>
                                            <button class="btn btn-sm btn-success task-action" data-action="complete" data-id="{{ task.id }}">Complete</button>
                                            <button class="btn btn-sm btn-info task-action" data-action="edit" data-id="{{ task.id }}">Edit</button>
                                            <button class="btn btn-sm btn-danger task-action" data-action="delete" data-id="{{ task.id }}">Delete</button>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <!-- Completed Tasks Tab -->
                        <div class="tab-pane fade" id="completed" role="tabpanel" aria-labelledby="completed-tab">
                            <div id="completedTasksList">
                                {% for task in completed_tasks %}
                                <div class="card task-card completed-task">
                                    <div class="card-body">
                                        <h5 class="card-title">{{ task.title }}</h5>
                                        <p class="card-text">{{ task.description }}</p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">Completed on: {{ task.completion_date }}</small>
                                            <button class="btn btn-sm btn-outline-secondary task-action" data-action="restore" data-id="{{ task.id }}">Restore</button>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Sidebar -->
                <div class="col-md-4">
                    <div class="sidebar">
                        <!-- Add New Task Form -->
                        <div class="add-task-form">
                            <h3>Add New Task</h3>
                            <form id="newTaskForm">
                                <div class="mb-3">
                                    <label for="taskTitle" class="form-label">Task Title</label>
                                    <input type="text" class="form-control" id="taskTitle" name="title" required>
                                </div>
                                <div class="mb-3">
                                    <label for="taskDescription" class="form-label">Description</label>
                                    <textarea class="form-control" id="taskDescription" name="description" rows="3"></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="taskEnergyRequired" class="form-label">Energy Required (1-10)</label>
                                    <input type="range" class="form-range" id="taskEnergyRequired" name="energy_required" min="1" max="10" value="5">
                                    <div class="text-center">
                                        <span id="taskEnergyValue">5</span>/10
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="taskPriority" class="form-label">Priority</label>
                                    <select class="form-select" id="taskPriority" name="priority">
                                        <option value="low">Low</option>
                                        <option value="medium" selected>Medium</option>
                                        <option value="high">High</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="taskDueDate" class="form-label">Due Date</label>
                                    <input type="date" class="form-control" id="taskDueDate" name="due_date">
                                </div>
                                <button type="submit" class="btn btn-primary w-100">Add Task</button>
                            </form>
                        </div>
                        
                        <!-- Task Statistics -->
                        <div class="task-stats mt-4">
                            <h3>Task Statistics</h3>
                            <div class="list-group">
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    Total Tasks
                                    <span class="badge bg-primary rounded-pill">{{ task_stats.total }}</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    Completed Today
                                    <span class="badge bg-success rounded-pill">{{ task_stats.completed_today }}</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    High Priority
                                    <span class="badge bg-danger rounded-pill">{{ task_stats.high_priority }}</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    Due Today
                                    <span class="badge bg-warning rounded-pill">{{ task_stats.due_today }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Task Edit Modal -->
    <div class="modal fade" id="editTaskModal" tabindex="-1" aria-labelledby="editTaskModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editTaskModalLabel">Edit Task</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editTaskForm">
                        <input type="hidden" id="editTaskId" name="task_id">
                        <div class="mb-3">
                            <label for="editTaskTitle" class="form-label">Task Title</label>
                            <input type="text" class="form-control" id="editTaskTitle" name="title" required>
                        </div>
                        <div class="mb-3">
                            <label for="editTaskDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="editTaskDescription" name="description" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="editTaskEnergyRequired" class="form-label">Energy Required (1-10)</label>
                            <input type="range" class="form-range" id="editTaskEnergyRequired" name="energy_required" min="1" max="10">
                            <div class="text-center">
                                <span id="editTaskEnergyValue">5</span>/10
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editTaskPriority" class="form-label">Priority</label>
                            <select class="form-select" id="editTaskPriority" name="priority">
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editTaskDueDate" class="form-label">Due Date</label>
                            <input type="date" class="form-control" id="editTaskDueDate" name="due_date">
                        </div>
                        <div class="mb-3">
                            <label for="editTaskProgress" class="form-label">Progress</label>
                            <input type="range" class="form-range" id="editTaskProgress" name="progress" min="0" max="100" step="10">
                            <div class="text-center">
                                <span id="editTaskProgressValue">0</span>%
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveTaskChanges">Save Changes</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteTaskModal" tabindex="-1" aria-labelledby="deleteTaskModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteTaskModalLabel">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this task?</p>
                    <p id="deleteTaskTitle" class="fw-bold"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteTask">Delete</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JavaScript for Task Management -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Update energy level value display
            const energySlider = document.getElementById('energyLevelSlider');
            const energyValue = document.getElementById('energyLevelValue');
            
            energySlider.addEventListener('input', function() {
                energyValue.textContent = this.value;
                document.querySelector('.energy-level').style.width = this.value * 10 + '%';
            });
            
            // Update task energy value display
            const taskEnergySlider = document.getElementById('taskEnergyRequired');
            const taskEnergyValue = document.getElementById('taskEnergyValue');
            
            if (taskEnergySlider) {
                taskEnergySlider.addEventListener('input', function() {
                    taskEnergyValue.textContent = this.value;
                });
            }
            
            // Update edit task energy value display
            const editTaskEnergySlider = document.getElementById('editTaskEnergyRequired');
            const editTaskEnergyValue = document.getElementById('editTaskEnergyValue');
            
            if (editTaskEnergySlider) {
                editTaskEnergySlider.addEventListener('input', function() {
                    editTaskEnergyValue.textContent = this.value;
                });
            }
            
            // Update edit task progress value display
            const editTaskProgressSlider = document.getElementById('editTaskProgress');
            const editTaskProgressValue = document.getElementById('editTaskProgressValue');
            
            if (editTaskProgressSlider) {
                editTaskProgressSlider.addEventListener('input', function() {
                    editTaskProgressValue.textContent = this.value;
                });
            }
            
            // Handle update energy level button
            const updateEnergyBtn = document.getElementById('updateEnergyBtn');
            
            if (updateEnergyBtn) {
                updateEnergyBtn.addEventListener('click', function() {
                    const energyLevel = energySlider.value;
                    
                    // Send the energy level to the server
                    fetch('/update_energy_level', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ energy_level: energyLevel })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Refresh the page to get updated task recommendations
                            window.location.reload();
                        } else {
                            alert('Failed to update energy level: ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error updating energy level:', error);
                        alert('An error occurred while updating energy level.');
                    });
                });
            }
            
            // Handle add new task form submission
            const newTaskForm = document.getElementById('newTaskForm');
            
            if (newTaskForm) {
                newTaskForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = {
                        title: this.querySelector('#taskTitle').value,
                        description: this.querySelector('#taskDescription').value,
                        energy_required: this.querySelector('#taskEnergyRequired').value,
                        priority: this.querySelector('#taskPriority').value,
                        due_date: this.querySelector('#taskDueDate').value
                    };
                    
                    // Send the task to the server
                    fetch('/add_task', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Reset the form
                            newTaskForm.reset();
                            // Refresh the page to show the new task
                            window.location.reload();
                        } else {
                            alert('Failed to add task: ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error adding task:', error);
                        alert('An error occurred while adding task.');
                    });
                });
            }
            
            // Handle task actions (start, complete, edit, delete)
            const taskActions = document.querySelectorAll('.task-action');
            
            taskActions.forEach(button => {
                button.addEventListener('click', function() {
                    const action = this.getAttribute('data-action');
                    const taskId = this.getAttribute('data-id');
                    
                    if (action === 'start') {
                        // Update the task progress to "in progress"
                        fetch('/update_task_progress', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ task_id: taskId, progress: 10 })
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                window.location.reload();
                            } else {
                                alert('Failed to start task: ' + data.message);
                            }
                        })
                        .catch(error => {
                            console.error('Error starting task:', error);
                            alert('An error occurred while starting task.');
                        });
                    } else if (action === 'complete') {
                        // Mark the task as complete
                        fetch('/complete_task', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ task_id: taskId })
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                window.location.reload();
                            } else {
                                alert('Failed to complete task: ' + data.message);
                            }
                        })
                        .catch(error => {
                            console.error('Error completing task:', error);
                            alert('An error occurred while completing task.');
                        });
                    } else if (action === 'edit') {
                        // Get the task details and populate the edit form
                        fetch('/get_task/' + taskId)
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                const task = data.task;
                                document.getElementById('editTaskId').value = task.id;
                                document.getElementById('editTaskTitle').value = task.title;
                                document.getElementById('editTaskDescription').value = task.description;
                                document.getElementById('editTaskEnergyRequired').value = task.energy_required;
                                document.getElementById('editTaskEnergyValue').textContent = task.energy_required;
                                document.getElementById('editTaskPriority').value = task.priority;
                                document.getElementById('editTaskDueDate').value = task.due_date;
                                document.getElementById('editTaskProgress').value = task.progress;
                                document.getElementById('editTaskProgressValue').textContent = task.progress;
                                
                                // Show the edit modal
                                const editModal = new bootstrap.Modal(document.getElementById('editTaskModal'));
                                editModal.show();
                            } else {
                                alert('Failed to get task details: ' + data.message);
                            }
                        })
                        .catch(error => {
                            console.error('Error getting task details:', error);
                            alert('An error occurred while getting task details.');
                        });
                    } else if (action === 'delete') {
                        // Get the task details for confirmation
                        fetch('/get_task/' + taskId)
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                document.getElementById('deleteTaskTitle').textContent = data.task.title;
                                document.getElementById('confirmDeleteTask').setAttribute('data-id', taskId);
                                
                                // Show the delete confirmation modal
                                const deleteModal = new bootstrap.Modal(document.getElementById('deleteTaskModal'));
                                deleteModal.show();
                            } else {
                                alert('Failed to get task details: ' + data.message);
                            }
                        })
                        .catch(error => {
                            console.error('Error getting task details:', error);
                            alert('An error occurred while getting task details.');
                        });
                    } else if (action === 'restore') {
                        // Restore a completed task
                        fetch('/restore_task', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ task_id: taskId })
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                window.location.reload();
                            } else {
                                alert('Failed to restore task: ' + data.message);
                            }
                        })
                        .catch(error => {
                            console.error('Error restoring task:', error);
                            alert('An error occurred while restoring task.');
                        });
                    }
                });
            });
            
            // Handle save task changes button
            const saveTaskChangesBtn = document.getElementById('saveTaskChanges');
            
            if (saveTaskChangesBtn) {
                saveTaskChangesBtn.addEventListener('click', function() {
                    const editForm = document.getElementById('editTaskForm');
                    const formData = {
                        task_id: editForm.querySelector('#editTaskId').value,
                        title: editForm.querySelector('#editTaskTitle').value,
                        description: editForm.querySelector('#editTaskDescription').value,
                        energy_required: editForm.querySelector('#editTaskEnergyRequired').value,
                        priority: editForm.querySelector('#editTaskPriority').value,
                        due_date: editForm.querySelector('#editTaskDueDate').value,
                        progress: editForm.querySelector('#editTaskProgress').value
                    };
                    
                    // Send the updated task to the server
                    fetch('/update_task', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                // Hide the modal
                                const editModal = bootstrap.Modal.getInstance(document.getElementById('editTaskModal'));
                                editModal.hide();
                                // Refresh the page to show the updated task
                                window.location.reload();
                            } else {
                                alert('Failed to update task: ' + data.message);
                            }
                        })
                        .catch(error => {
                            console.error('Error updating task:', error);
                            alert('An error occurred while updating task.');
                        });
                });
            }
            
            // Handle confirm delete task button
            const confirmDeleteTaskBtn = document.getElementById('confirmDeleteTask');
            
            if (confirmDeleteTaskBtn) {
                confirmDeleteTaskBtn.addEventListener('click', function() {
                    const taskId = this.getAttribute('data-id');
                    
                    // Send the delete request to the server
                    fetch('/delete_task', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ task_id: taskId })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Hide the modal
                            const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteTaskModal'));
                            deleteModal.hide();
                            // Refresh the page to show the updated task list
                            window.location.reload();
                        } else {
                            alert('Failed to delete task: ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error deleting task:', error);
                        alert('An error occurred while deleting task.');
                    });
                });
            }
        });
    </script>
</body>
</html>